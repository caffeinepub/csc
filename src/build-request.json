{
  "kind": "build_request",
  "title": "Make admin secret deterministically grant admin privileges to any caller",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-98",
      "text": "Update backend admin-session bootstrapping so that calling `_initializeAccessControlWithSecret(secret)` with the correct secret `admin-secret-token-2024` ALWAYS grants admin privileges to the current caller (the principal making the call), regardless of whether another principal was previously granted admin.",
      "target": "backend",
      "source": {
        "messageIds": [
          "recent-messages"
        ],
        "quotes": [
          "YES, MAKE SECRET ALWAYS GIVE ADMIN"
        ]
      },
      "acceptanceCriteria": [
        "Given any principal P1, when P1 calls `_initializeAccessControlWithSecret(\"admin-secret-token-2024\")`, then subsequent calls by P1 to admin-gated APIs (at minimum `getAllInquiries`, `setInquiryReadStatus`, `deleteInquiry`) succeed without Unauthorized errors.",
        "Given a different principal P2 (not equal to P1), when P2 calls `_initializeAccessControlWithSecret(\"admin-secret-token-2024\")`, then subsequent calls by P2 to admin-gated APIs also succeed (i.e., admin is not restricted to the first principal).",
        "The initialization must not rely on or enforce a single global 'already initialized/admin assigned' flag that prevents later callers from becoming admin when using the correct secret.",
        "If the secret is incorrect, `_initializeAccessControlWithSecret` must not grant admin privileges and admin-gated APIs must continue to fail with an Unauthorized error."
      ]
    },
    {
      "id": "REQ-99",
      "text": "Ensure the backend exposes a query method `isCallerAdmin()` that returns whether the current caller is authorized as admin, and that its result reflects the updated per-caller admin authorization state granted by `_initializeAccessControlWithSecret`.",
      "target": "backend",
      "source": {
        "messageIds": [
          "recent-messages"
        ],
        "quotes": [
          "YES, MAKE SECRET ALWAYS GIVE ADMIN"
        ]
      },
      "acceptanceCriteria": [
        "After calling `_initializeAccessControlWithSecret(\"admin-secret-token-2024\")`, `isCallerAdmin()` returns `true` for that caller.",
        "Without calling `_initializeAccessControlWithSecret` (or after calling it with a wrong secret), `isCallerAdmin()` returns `false` for that caller.",
        "`useAdminActor` (frontend) can successfully call `isCallerAdmin()` without backend traps, and the admin dashboard no longer shows “Admin Session Initialization Failed” due to missing admin privileges when the correct secret is used."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor with logic in `backend/main.mo` (respect single-actor architecture).",
    "Do not change the Official Login credential values or admin secret token value; keep token exactly `admin-secret-token-2024` and the sessionStorage key exactly `caffeineAdminToken`.",
    "Use English for any user-facing text."
  ],
  "nonGoals": [
    "Do not implement new authentication methods (e.g., third-party auth, Internet Identity changes) as part of this change.",
    "Do not redesign the admin dashboard UI beyond what is necessary to support the corrected backend authorization behavior.",
    "Do not change inquiry persistence/migration behavior in this request unless required to implement the admin-authorization fix."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}